langcode: en
status: true
dependencies: { }
id: custom_peertube_migration_vtt
label: 'Extract peertube video captions to drupal'
class: null
field_plugin_method: null
cck_plugin_method: null
migration_group: custom_peertube_migration

source:
  plugin: content_entity:media
  entity_type: media
  bundle: remote_video
  fields:
    - mid
    - vid
    - name
    - field_media_oembed_video
    - field_media_of
process:
  # map source fields onto destination
  vid:
    plugin: get
    source: vid
  id:
    plugin: get
    source: mid 
  parent_repo_item_id:
    plugin: get
    source: field_media_of/0/target_id
  oembed_url:                           
    plugin: extract                      
    source: field_media_oembed_video     
    index: [0, value]
    default_value: ''
  oembed_video_data:                               
    plugin: video_vtt_source               
    source: 
      - field_media_oembed_video/0/value 
      - field_media_of/0/target_id
      - name/0/value
  name:                                                                                                                            
    plugin: extract                                                                                                                
    source: name                                                                                                                   
    index: [0, value]
destination: 
  plugin: csv_export_vtt
migration_tags:
  - 'Export'
migration_dependencies: null